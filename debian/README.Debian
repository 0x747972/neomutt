###############################################################################
# Description:   How to build a Debian package from neomutt's git source
# Author:        Elimar Riesebieter <riesebie@lxtec.de>
# Created:       Sat, 15 Apr 2017 12:32:08 +0200
# Last modified: Sun, 29 Oct 2017 08:32:55 +0100
# File:          /source/neomutt/git/neomutt/debian/README.Debian
###############################################################################

Clone the sources:
$ git clone https://github.com/neomutt/neomutt.git.

Checkout distro/debian:
$ cd neomutt
$ git checkout distro/debian

Create a package from default settings:
$ sudo apt install gitpkg
$ gitpkg distro/debian

You will find the package at:
$ ls ../deb-packages/neomutt/

###############################################################################

Preparing for customizing:
$ git checkout -b mybranch

Make changes to whatever file in the debian dir.

NeoMutt is now build with autosetup.
Create a package from customized settings:
$ sudo apt install gitpkg
$ gitpkg mybranch

You will find the package at:
$ ls ../deb-packages/neomutt/

###############################################################################

The default will build with:

./configure.autosetup			\
	--with-mailpath=/var/mail	\
	--gpgme				\
	--fmemopen			\
	$(notmuch)			\
	--logging			\
	--lua				\
	--mixmaster			\
	--with-ui=ncurses		\
	--gss				\
	--gnutls			\
	--sasl				\
	$(hcache_db)

Whereas hcache_db points to lmdb. You can change hcache_db by adjusting
debian/rules.

To suite to your own settings adapt debian/rules accordingly. debian/control has
to be adapted to point to you as an uploader and force to demand the dev
packages needed for your changes. This is the case for changing the header cache.

###############################################################################

To build the package:

$ cp -av ../deb-packages/neomutt/neomutt_YYYYMMDD mybuilddir
$ apt install devscripts
$ cd mybuilddir
$ dpkg-source -x neomutt_YYYYMMDD-1lxtec1.dsc
$ cd neomutt-YYYYMMDD
$ dpkg-buildpackage -us -uc

After a successful build the deb's should be in ../ ;-)

Please note that a pristine Debian mutt install will be removed. Installing
neomutt will have /etc/neomuttrc and /etc/NeoMuttrc.d. The neomutt-common
package includes all the documentation and contribs from neomutt's source.
To go back to Debian's mutt please first remove the neomutt packages:

# apt remove --purge neomutt-common.

If you hit a bug or want to propose optimizations to the package please send me an
e-mail or we can discuss any issue according to distro/debian at
https://github.com/neomutt/neomutt/issues ,at
http://mailman.neomutt.org/mailman/listinfo/neomutt-devel-neomutt.org or
irc://irc.freenode.net/neomutt.
